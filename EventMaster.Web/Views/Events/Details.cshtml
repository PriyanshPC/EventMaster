@model EventMaster.Web.Models.EventDetailsViewModel
@{
    ViewData["Title"] = Model.Details.EventName;
}

<div class="container my-4">

    <!-- HEADER CARD -->
    <div class="card em-details-header mb-4">
        <div class="row g-0">
            <div class="col-12 col-lg-3">
                <img class="em-details-img" src="@Model.ImageUrl" alt="@Model.Details.EventName" />
            </div>

            <div class="col-12 col-lg-9">
                <div class="card-body">
                    <div class="em-pill">@Model.Details.Category</div>

                    <h1 class="h4 fw-bold mt-2 mb-1">@Model.Details.EventName</h1>

                    <div class="text-muted mb-2">
                        <div><i class="bi bi-calendar-event me-1"></i> @Model.HeaderWhen</div>
                        <div><i class="bi bi-geo-alt me-1"></i> @Model.HeaderWhere</div>
                        <div><i class="bi bi-cash-coin me-1"></i> $@Model.Details.Price / ticket</div>
                        <div><i class="bi bi-people me-1"></i> Remaining: @Model.Details.RemainingCapacity</div>
                        <div><i class="bi bi-info-circle me-1"></i> Status: @Model.Details.Status</div>
                    </div>

                    <div class="d-flex flex-wrap gap-2 mt-3">
                        <a class="btn btn-primary"
                           asp-controller="Bookings"
                           asp-action="Create"
                           asp-route-occurrenceId="@Model.OccurrenceId">
                            Book Ticket
                        </a>

                        <a class="btn btn-outline-secondary"
                           asp-controller="Events"
                           asp-action="Index">
                            Back to Events
                        </a>
                    </div>

                    <div class="text-muted small mt-3">
                        Organizer: <span class="fw-semibold">@Model.Details.OrganizerName</span>
                        • @Model.Details.OrganizerEmail
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TWO PANELS -->
    <div class="row g-4">
        <!-- LEFT: REVIEWS (70%) -->
        <div class="col-12 col-lg-8">
            <div class="d-flex align-items-center justify-content-between mb-2">
                <h2 class="h5 fw-bold mb-0">Reviews</h2>

                @if (Model.ShowAddReviewButton)
                {
                    <a class="btn btn-outline-primary btn-sm"
                       asp-controller="Reviews"
                       asp-action="Create"
                       asp-route-eventId="@Model.EventId">
                        Add Review
                    </a>
                }
            </div>

            @if (Model.Reviews.Count == 0)
            {
                <div class="alert alert-light border">
                    No reviews yet.
                </div>
            }
            else
            {
                <div class="card mb-3">
                    @foreach (var r in Model.Reviews)
                    {
                        <div class="card-body">
                            <div class="d-flex align-items-start justify-content-between gap-3">
                                <div>
                                    <div class="fw-semibold">@r.CustomerName</div>
                                    <div class="text-muted small">@r.CreatedAt.ToLocalTime().ToString("MMM d, yyyy")</div>
                                </div>

                                <!-- Stars -->
                                <div class="em-stars" aria-label="Rating @r.Rating out of 5">
                                    @for (int i = 1; i <= 5; i++)
                                    {
                                        if (i <= r.Rating)
                                        {
                                            <i class="bi bi-star-fill"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-star"></i>
                                        }
                                    }
                                </div>
                            </div>

                            @if (!string.IsNullOrWhiteSpace(r.Comment))
                            {
                                <div class="mt-2">@r.Comment</div>
                            }

                            @if (r.Replies != null && r.Replies.Count > 0)
                            {
                                <div class="mt-3">
                                    @foreach (var rep in r.Replies)
                                    {
                                        <div class="em-reply">
                                            <div class="d-flex align-items-center justify-content-between">
                                                <div class="fw-semibold">
                                                    Reply • @rep.OrganizerName
                                                </div>
                                                <div class="text-muted small">
                                                    @rep.CreatedAt.ToLocalTime().ToString("MMM d, yyyy")
                                                </div>
                                            </div>
                                            <div class="mt-1">@rep.ReplyText</div>
                                        </div>
                                    }
                                </div>
                            }
                        </div>
                    }
                </div>

            }
        </div>

        <!-- RIGHT: DESCRIPTION (30%) -->
        <div class="col-12 col-lg-4">
            <h2 class="h5 fw-bold mb-2">Description</h2>
            <div class="card">
                <div class="card-body">
                    <h2 class="h6 fw-bold mb-2">About this event</h2>

                    <div class="text-muted">
                        @if (string.IsNullOrWhiteSpace(Model.Details.Description))
                        {
                            <span>No description provided.</span>
                        }
                        else
                        {
                            @Model.Details.Description
                        }
                    </div>

                    <hr />

                    <div class="small text-muted">
                        <div class="fw-bold text-dark mb-1">Venue</div>
                        <div>@Model.Details.VenueName</div>
                        <div>@Model.Details.Address</div>
                        <div>@Model.Details.City, @Model.Details.Province @Model.Details.PostalCode</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>